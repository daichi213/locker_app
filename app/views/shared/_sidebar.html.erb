<% if logged_in? %>
    <div class='col-md-2 slidebar'>
        <nav class='navbar navbar-fixed'>
            <section class="user_info">
                <div>
                    <h1 class="user-image">
                        <%= link_to current_user do %>
                            <% if current_user.picture? %>
                                <%= image_tag current_user.picture.thumb50.url %>
                            <% else %>
                                <%= image_tag "/uploads/user/picture/thumb50_default.jpg" %>
                            <% end %>
                        <% end %>
                        <%= current_user.name %>
                    </h1>
                    <% if request.fullpath != "/users/#{params[:id]}/edit" %>
                        <span><%= link_to "編集", edit_user_path(current_user) %></span>
                    <% end %>
                </div>
            </section>
            <section class="stats">
                <%#= render 'shared/stats' %>
            </section>
            <section class='menu-content'>
                <ul>
                    <% if request.fullpath == root_path %>

                    <% elsif (request.fullpath == users_path) || (request.fullpath == (users_path + "?page=#{params[:page]}")) %>
                        <%= form_tag("/search", method: "get") do %>
                            <%= label :area, 'ユーザーを絞り込む' %>
                            <%= text_field_tag :area %>
                            <%= submit_tag "探す" %>
                        <% end %>
                        <input id='search_range'>
                        <%= button_tag '現在地周辺のユーザーを探す', class: 'current_location' %>
                        <script>
                            $('.current_location').on('click',
                                function geoFindUser();
                            );

                            function geoFindUser() {
                                //ユーザーのブラウザがGeolocation APIに対応していた場合
                                if (navigator.geolocation) {

                                    //getCurrentPositionメソッドで現在地を取得
                                    navigator.geolocation.getCurrentPosition(

                                        //現在地の取得に成功した場合の処理
                                        function(position) {

                                            //データを変数にして整理（position.coords.latitude/longitudeが座標）
                                            var lat = position.coords.latitude;
                                            var lng = position.coords.longitude;

                                            var range = document.getElementById("search_range");
                                            if (range == nil) {range = 5;}

                                            //座標のデータをクエリパラメータとし、座標データを渡したいページに遷移させる
                                            //Javascriptで文字列の中に変数を入れたいときは、バッククオートで囲む
                                            window.location.href = `/"users"/searches?latitude=${lat}&longitude=${lng}&range=${range}`
                                        },

                                        //現在地の取得に失敗した場合の処理
                                        function (error) {
                                            //エラー情報を配列として定義
                                            var errorInfo = [
                                                "原因不明のエラーが発生しました…。" ,
                                                "位置情報の取得が許可されませんでした…。" ,
                                                "電波状況などで位置情報が取得できませんでした…。" ,
                                                "位置情報の取得に時間がかかり過ぎてタイムアウトしました…。"
                                            ] ;

                                            //エラーコードを変数に代入（エラーコードはgetCurrentPositionの引数として受け取っている）
                                            var errorNo = error.code ;
                                            //エラーメッセージに、先に定義したエラーコードと、エラー番号に対応した情報をalert表示させる
                                            var errorMessage = "[エラー番号: " + errorNo + "]\n" + errorInfo[ errorNo ] ;
                                            alert( errorMessage ) ;
                                        } 
                                        //オプション設定（10秒でタイムアウトになる）
                                        {
                                        "enableHighAccuracy": false,
                                        "timeout": 10000,
                                        "maximumAge": 0,
                                        }
                                    );
                                }

                                //ユーザーのブラウザがGeolocation APIに対応していなかった場合の処理
                                else {
                                    var errorMessage = "お使いの端末は、GeoLacation APIに対応していません。" ;

                                    alert( errorMessage ) ;
                                }
                                }
                        </script>

                    <% elsif request.fullpath == user_path(current_user) %>
                        <li><%= link_to "マップ", "#" %></li>
                        <li><%= link_to "リクエスト一覧", root_path %></li>
                        <li><%= link_to "リクエスト依頼", "#" %></li>
                        <li><%= link_to "リクエスト依頼", "#" %></li>
                        <li><%= link_to "リクエスト依頼", "#" %></li>
                        <li><%= link_to "リクエスト依頼", "#" %></li>
                    <% end %>
                </ul>
            </section>
        </nav>
    </div>
<% end %>